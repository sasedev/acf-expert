{% extends 'AcfFrontBundle::front.html.twig' %}
{%block end_static_js%}
{{ parent() }}
<script type="text/javascript" src="{{asset('bundles/acfres/js/chartjs/1.1.min.js')}}"></script>
{%endblock end_static_js%}
{%block end2_dynamic_jstxt%}
$(function() {
	{% if companies | length != 0 %}
	{% for cmp in companies %}

	{% if cmp.natures|length !=0 %}
	var datanat_{{ cmp.company.idn }} = [
	{% for nat in cmp.natures %}
		{
		value: {{ nat.val|number_format(3, '.', '') }},
		color:"rgba({{ nat.nature.colorRGB.r }}, {{ nat.nature.colorRGB.g }}, {{ nat.nature.colorRGB.b }},0.5)",
		highlight: "rgba({{ nat.nature.colorRGB.r }}, {{ nat.nature.colorRGB.g }}, {{ nat.nature.colorRGB.b }},0.75)",
		label: "{{ nat.nature.label|e('js') }}"
	}{% if not loop.last %},{% endif %}
	{% endfor %}
	];

	var ctx1_{{ cmp.company.idn }} = $("#myDonutChart_{{ cmp.company.idn }}").get(0).getContext("2d");
	var myDonutChart_{{ cmp.company.idn }} = new Chart(ctx1_{{ cmp.company.idn }}).Doughnut(datanat_{{ cmp.company.idn }});
	{% endif %}


	var dataca_{{ cmp.company.idn }} = {
		labels: ["Janvier", "Fevrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Aout", "Septembre", "Octobre", "Novembre", "Décembre"],
		datasets: [
			{
				label: "{{ prev_year }}",
				fillColor: "rgba(220,220,220,0.5)",
				strokeColor: "rgba(220,220,220,0.8)",
				highlightFill: "rgba(220,220,220,0.75)",
				highlightStroke: "rgba(220,220,220,1)",
				data: [{{ cmp.cas.prev_year.m1 }}, {{ cmp.cas.prev_year.m2 }}, {{ cmp.cas.prev_year.m3 }}, {{ cmp.cas.prev_year.m4 }}, {{ cmp.cas.prev_year.m5 }}, {{ cmp.cas.prev_year.m6 }}, {{ cmp.cas.prev_year.m7 }}, {{ cmp.cas.prev_year.m8 }}, {{ cmp.cas.prev_year.m9 }}, {{ cmp.cas.prev_year.m10 }}, {{ cmp.cas.prev_year.m11 }}, {{ cmp.cas.prev_year.m12 }}]
			},
			{
				label: "{{ current_year }}",
				fillColor: "rgba(151,187,205,0.5)",
				strokeColor: "rgba(151,187,205,0.8)",
				highlightFill: "rgba(151,187,205,0.75)",
				highlightStroke: "rgba(151,187,205,1)",
				data: [{{ cmp.cas.current_year.m1 }}, {{ cmp.cas.current_year.m2 }}, {{ cmp.cas.current_year.m3 }}, {{ cmp.cas.current_year.m4 }}, {{ cmp.cas.current_year.m5 }}, {{ cmp.cas.current_year.m6 }}, {{ cmp.cas.current_year.m7 }}, {{ cmp.cas.current_year.m8 }}, {{ cmp.cas.current_year.m9 }}, {{ cmp.cas.current_year.m10 }}, {{ cmp.cas.current_year.m11 }}, {{ cmp.cas.current_year.m12 }}]
			}
		]
	};

	var datadec_{{ cmp.company.idn }} = {
		labels: ["Janvier", "Fevrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Aout", "Septembre", "Octobre", "Novembre", "Décembre"],
		datasets: [
			{
				label: "{{ prev_year }}",
				fillColor: "rgba(220,220,220,0.5)",
				strokeColor: "rgba(220,220,220,0.8)",
				highlightFill: "rgba(220,220,220,0.75)",
				highlightStroke: "rgba(220,220,220,1)",
				data: [{{ cmp.decs.prev_year.m1 }}, {{ cmp.decs.prev_year.m2 }}, {{ cmp.decs.prev_year.m3 }}, {{ cmp.decs.prev_year.m4 }}, {{ cmp.decs.prev_year.m5 }}, {{ cmp.decs.prev_year.m6 }}, {{ cmp.decs.prev_year.m7 }}, {{ cmp.decs.prev_year.m8 }}, {{ cmp.decs.prev_year.m9 }}, {{ cmp.decs.prev_year.m10 }}, {{ cmp.decs.prev_year.m11 }}, {{ cmp.decs.prev_year.m12 }}]
			},
			{
				label: "{{ current_year }}",
				fillColor: "rgba(151,187,205,0.5)",
				strokeColor: "rgba(151,187,205,0.8)",
				highlightFill: "rgba(151,187,205,0.75)",
				highlightStroke: "rgba(151,187,205,1)",
				data: [{{ cmp.decs.current_year.m1 }}, {{ cmp.decs.current_year.m2 }}, {{ cmp.decs.current_year.m3 }}, {{ cmp.decs.current_year.m4 }}, {{ cmp.decs.current_year.m5 }}, {{ cmp.decs.current_year.m6 }}, {{ cmp.decs.current_year.m7 }}, {{ cmp.decs.current_year.m8 }}, {{ cmp.decs.current_year.m9 }}, {{ cmp.decs.current_year.m10 }}, {{ cmp.decs.current_year.m11 }}, {{ cmp.decs.current_year.m12 }}]
			}
		]
	};

	var ctx2_{{ cmp.company.idn }} = $("#myCaChart_{{ cmp.company.idn }}").get(0).getContext("2d");
	var myCaChart_{{ cmp.company.idn }} = new Chart(ctx2_{{ cmp.company.idn }}).Bar(dataca_{{ cmp.company.idn }});


	var ctx3_{{ cmp.company.idn }} = $("#myDecChart_{{ cmp.company.idn }}").get(0).getContext("2d");
	var myDecChart_{{ cmp.company.idn }} = new Chart(ctx3_{{ cmp.company.idn }}).Line(datadec_{{ cmp.company.idn }});


	{% endfor %}
	{% endif %}

});
{%endblock end2_dynamic_jstxt%}
{%block breadcrumb%}
<ol class="breadcrumb">
	<li class="active"><a href="{{ path('_client_homepage') }}">{{ faIco('dashboard') }} &nbsp; {{'breadcrumb.client'|trans|raw}}</a></li>
</ol>
{%endblock breadcrumb%}
{%block content%}
{% if companies | length != 0 %}
{% for cmp in companies %}
<div class="row">
	<div class="col-lg-12">
		<h3><a href="{{ path('_client_company_editGet', {'uid': cmp.company.id}) }}">{{ cmp.company.corporateName }}</a></h3>
	</div>
	<div class="col-lg-6">
		<div class="box box-primary">
			<div class="box-header with-border"><h4 class="box-title">Chiffres du Mois ({{ current_month }} - {{ current_year }})</h4></div>
			<div class="box-body">
				<div class="row">
					<div class="col-lg-6 text-right">Chiffre d'affaire :</div>
					<div class="col-lg-6 text-right">{{ cmp.ca|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

					<div class="col-lg-6 text-right">Achat de Marchandise :</div>
					<div class="col-lg-6 text-right">{{ cmp.am|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

					<div class="col-lg-6 text-right">Décaissement :</div>
					<div class="col-lg-6 text-right">{{ cmp.dec|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

					<div class="col-lg-6 text-right">Encaissement :</div>
					<div class="col-lg-6 text-right">{{ cmp.enc|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

					{% for bnk in cmp.banks %}
					<div class="col-lg-6 text-right">Solde en Banque ({{ bnk.bank.label }}) :</div>
					<div class="col-lg-6 text-right">{{ (bnk.enc - bnk.dec)|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

					{% endfor %}

					{% for fnd in cmp.funds %}
					<div class="col-lg-6 text-right">Solde en Caisse ({{ fnd.fund.label }}) :</div>
					<div class="col-lg-6 text-right">{{ (fnd.enc - fnd.dec)|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

					{% endfor %}

				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-6">
		<div class="box box-primary">
			<div class="box-header with-border"><h4 class="box-title">Chiffres du 01/01/{{ current_year }} au {{ 'now'|date('d/m/Y') }}</h4></div>
			<div class="box-body">
				<div class="row">
					<div class="col-lg-6 text-right">Chiffre d'affaire :</div>
					<div class="col-lg-6 text-right">{{ cmp.cacumul|number_format(3, '.', ' ') }} TND</div>
					<div class="col-lg-12">&nbsp;</div>

				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-12">
		<hr/>
	</div>
	{% if cmp.natures|length !=0 %}
	<div class="col-lg-4">
		<div class="box box-primary">
			<div class="box-header with-border"><h4 class="box-title">Achats {{ current_year }}</h4></div>
			<div class="box-body">
				<div class="chart">
					<canvas id="myDonutChart_{{ cmp.company.idn }}"></canvas>
				</div>
			</div>
		</div>
	</div>
	{% endif %}
	<div class="col-lg-{% if cmp.natures|length !=0 %}4{% else %}6{% endif %}">
		<div class="box box-primary">
			<div class="box-header with-border"><h4 class="box-title">Evolution Chiffre d'affaire du 01/01/{{ prev_year }} au {{ 'now'|date('d/m/Y') }}</h4></div>
			<div class="box-body">
				<div class="chart">
					<canvas id="myCaChart_{{ cmp.company.idn }}"></canvas>
				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-{% if cmp.natures|length !=0 %}4{% else %}6{% endif %}">
		<div class="box box-primary">
			<div class="box-header with-border"><h4 class="box-title">Evolution Achats du 01/01/{{ prev_year }} au {{ 'now'|date('d/m/Y') }}</h4></div>
			<div class="box-body">
				<div class="chart">
					<canvas id="myDecChart_{{ cmp.company.idn }}"></canvas>
				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-12">
		<hr/>
	</div>
</div>
{% endfor %}
{% else %}
Interface Client
{% endif %}
{%endblock content%}